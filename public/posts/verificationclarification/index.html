<!DOCTYPE html>
<html><head lang="en"><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Verification Clarification - Leandro&#39;s Code Cave</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="NahamCon2025 CTF Malware Reversing Challenge" />
	<meta property="og:image" content=""/>
	<meta property="og:url" content="http://localhost:1313/posts/verificationclarification/">
  <meta property="og:site_name" content="Leandro&#39;s Code Cave">
  <meta property="og:title" content="Verification Clarification">
  <meta property="og:description" content="NahamCon2025 CTF Malware Reversing Challenge">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-09-13T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-09-13T00:00:00+00:00">
    <meta property="article:tag" content="Malware-Analysis">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Verification Clarification">
  <meta name="twitter:description" content="NahamCon2025 CTF Malware Reversing Challenge">

        <link href="http://localhost:1313/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="http://localhost:1313/css/main.b0bfd4c1c007ce46fdc69a6e3de4f0b25506edf76237167518be43f19df70205.css" />
		<link id="darkModeStyle" rel="stylesheet" type="text/css" href="http://localhost:1313/css/dark.6cfa4c73670a694b4297832c956ee7536c42d3f2c7ad8358e1da5070ec4f5a55.css"  disabled />
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="http://localhost:1313/">Leandro&#39;s Code Cave</a>
	</div>
	<nav>
		
		<a href="/">Home</a>
		
		<a href="/posts">All posts</a>
		
		<a href="/about">About</a>
		
		<a href="/tags">Tags</a>
		
		<button id="dark-mode-toggle" class="nav-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode" type="button"><svg class="feather" viewBox="0 0 24 24" fill="none" stroke="#232333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg></button>
		<script src="http://localhost:1313/js/themetoggle.js"></script>
		
	</nav>
</header>

<main>
  <article>
    <div class="post-container">
      
      <div class="post-content">
        <div class="title">
          <h1 class="title">Verification Clarification</h1>
          <div class="meta">Posted on Sep 13, 2025</div>
        </div>
        
        <div class="tldr">
          <strong>tl;dr:</strong>
          A fake &#34;captcha.zip&#34; verification page places a PowerShell download-and-run command into your clipboard; the payload fetches a staged, multi-encoded PowerShell loader via a DNS TXT lookup - decode the stages (Base64 ‚Üí Inflate ‚Üí string fixes) to reveal the final payload and flag.
        </div>
        <section class="body">
          <h1 id="challenge-description">Challenge Description</h1>
<p><strong>Author:</strong> @resume</p>
<p><strong>Difficulty:</strong> üü° Medium</p>
<p>One of our users received an unexpected email asking them to complete extra verification in order to download a zip file, but they weren‚Äôt expecting to receive any files.</p>
<p>Your task is to investigate the verification <strong>link</strong> provided in the email and determine if it‚Äôs suspicious or potentially malicious (‚Äúphishy‚Äù).</p>
<blockquote>
<p><strong>Note:</strong> If the verification link doesn‚Äôt respond when you visit it directly, try accessing it using a different method or tool. The challenge is functional, and you should receive a response.</p>
</blockquote>
<p><a href="https://captcha.zip/">captcha.zip</a></p>
<h2 id="solution">Solution</h2>
<p>The challenge begins by accessing the provided <a href="https://captcha.zip/">captcha.zip</a> URL, which actually points to a web page rather than a ZIP file.</p>

<div class='callout callout-customimg' style='text-align:center; '>
  <div class="callout-inner">
    
      <img src="https://github.com/IamLeandrooooo/MalwareCTFChallenges/blob/main/2025/NahamCon2025-CTF/Verification%20Clarification/images/1.png?raw=true" alt="Screenshot of the challenge page">
    
  </div>
</div>

<p>This challenge presents a fake CAPTCHA page designed to trick the user into copying a malicious command to their clipboard, with the goal of getting them to unknowingly execute it on their own machine. This behavior is confirmed when clicking the <strong>&ldquo;I&rsquo;m not a robot&rdquo;</strong> button, which follows the same pattern by placing a malicious command in the clipboard, attempting to deceive the user into running it locally.</p>

<div class='callout callout-customimg' style='text-align:center; '>
  <div class="callout-inner">
    
      <img src="https://github.com/IamLeandrooooo/MalwareCTFChallenges/blob/main/2025/NahamCon2025-CTF/Verification%20Clarification/images/2.png?raw=true" alt="Screenshot of the challenge page">
    
  </div>
</div>

<p>When pasting the clipboard contents into PowerShell, the malicious payload becomes visible. The payload uses <code>irm</code> (Invoke-RestMethod) to download a script from the <code>/verify</code> endpoint, then executes it directly in memory using <code>iex</code> (Invoke-Expression). This technique allows the script to run without being saved to disk, making it harder to detect.</p>

<div class='callout callout-customimg' style='text-align:center; '>
  <div class="callout-inner">
    
      <img src="https://github.com/IamLeandrooooo/MalwareCTFChallenges/blob/main/2025/NahamCon2025-CTF/Verification%20Clarification/images/3.png?raw=true" alt="Screenshot of the challenge page">
    
  </div>
</div>

<p>In this case, to avoid executing the payload in memory and instead inspect the next stage, the <code>iex</code> command is removed before running the script. This allows us to observe the subsequent payload stage without triggering execution.</p>

<div class='callout callout-customimg' style='text-align:center; '>
  <div class="callout-inner">
    
      <img src="https://github.com/IamLeandrooooo/MalwareCTFChallenges/blob/main/2025/NahamCon2025-CTF/Verification%20Clarification/images/4.png?raw=true" alt="Screenshot of the challenge page">
    
  </div>
</div>

<p>The next stage reveals a variable encoded in Base64, which is decoded and executed in a new shell context using the <code>ShellExecute</code> command. Decoding this Base64 payload with CyberChef shows that it queries the host <code>5gmlw.pyrchdata.com</code> for a TXT DNS record.</p>

<div class='callout callout-customimg' style='text-align:center; '>
  <div class="callout-inner">
    
      <img src="https://github.com/IamLeandrooooo/MalwareCTFChallenges/blob/main/2025/NahamCon2025-CTF/Verification%20Clarification/images/5.png?raw=true" alt="Screenshot of the challenge page">
    
  </div>
</div>

<p>In this stage, I used two methods to retrieve the TXT DNS record for <code>5gmlw.pyrchdata.com</code>.</p>
<p>First, I ran the following PowerShell command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>nslookup -type=TXT 5gmlw.pyrchdata.com <span style="color:#ae81ff">8.8</span>.8.8
</span></span></code></pre></div>
<div class='callout callout-customimg' style='text-align:center; '>
  <div class="callout-inner">
    
      <img src="https://github.com/IamLeandrooooo/MalwareCTFChallenges/blob/main/2025/NahamCon2025-CTF/Verification%20Clarification/images/6_1.png?raw=true" alt="Screenshot of the challenge page">
    
  </div>
</div>

<p>Second, I used the online tool <a href="https://mxtoolbox.com/">MXToolbox</a> to perform the same query.</p>

<div class='callout callout-customimg' style='text-align:center; '>
  <div class="callout-inner">
    
      <img src="https://github.com/IamLeandrooooo/MalwareCTFChallenges/blob/main/2025/NahamCon2025-CTF/Verification%20Clarification/images/6_2.png?raw=true" alt="Screenshot of the challenge page">
    
  </div>
</div>

<p>Choosing between these methods depends on personal preference. I used both to compare outputs and to explore different tools and approaches.</p>
<p>The TXT record contains another Base64-encoded string, which likely represents the next stage of the malware payload.</p>
<p>When decoding the Base64 string from the TXT DNS record, the next stage of the payload becomes visible.</p>

<div class='callout callout-customimg' style='text-align:center; '>
  <div class="callout-inner">
    
      <img src="https://github.com/IamLeandrooooo/MalwareCTFChallenges/blob/main/2025/NahamCon2025-CTF/Verification%20Clarification/images/7.png?raw=true" alt="Screenshot of the challenge page">
    
  </div>
</div>

<p>The payload is a PowerShell command that:</p>
<ol>
<li>
<p><strong>Decodes a Base64 string:</strong><br>
The embedded Base64-encoded string is converted into a byte array using <code>[System.Convert]::FromBase64String()</code>.</p>
</li>
<li>
<p><strong>Decompresses the data:</strong><br>
The byte array is then decompressed using the DEFLATE algorithm through <code>System.IO.Compression.DeflateStream</code>.</p>
</li>
<li>
<p><strong>Reads the decompressed script:</strong><br>
A <code>System.IO.StreamReader</code> reads the decompressed data as ASCII text, revealing the next stage of the payload.</p>
</li>
<li>
<p><strong>Executes the script in memory:</strong><br>
The final part dynamically constructs and executes the script in memory, likely using <code>Invoke-Expression</code> (<code>iex</code>) or a similar method to avoid writing to disk.</p>
</li>
</ol>
<p>To decode the Base64-encoded payload, I used CyberChef with a <strong>Base64 decode</strong> followed by a <strong>Raw Inflate</strong> operation to decompress the data.</p>

<div class='callout callout-customimg' style='text-align:center; '>
  <div class="callout-inner">
    
      <img src="https://github.com/IamLeandrooooo/MalwareCTFChallenges/blob/main/2025/NahamCon2025-CTF/Verification%20Clarification/images/8.png?raw=true" alt="Screenshot of the challenge page">
    
  </div>
</div>

<p>Looking at the decoded result, only some parts appeared meaningful. Upon closer inspection, I noticed that certain words were reversed. For example, <code>;metsyS gn'+'isu</code> corresponds to <code>using System;</code>, and <code>;secivreS'+'poretn'+'I.emitnuR.metsyS'+' gnisu</code> translates to <code>using System.Runtime.InteropServices;</code>.</p>
<p>With this in mind, I applied a <strong>reverse</strong> operation in CyberChef to restore the reversed strings into a readable format.</p>

<div class='callout callout-customimg' style='text-align:center; '>
  <div class="callout-inner">
    
      <img src="https://github.com/IamLeandrooooo/MalwareCTFChallenges/blob/main/2025/NahamCon2025-CTF/Verification%20Clarification/images/9.png?raw=true" alt="Screenshot of the challenge page">
    
  </div>
</div>

<p>After reversing the strings, the payload started to make more sense and became easier to read. While analyzing the script further, I noticed it contained another Base64-like string, but attempting to decode it directly failed.</p>

<div class='callout callout-customimg' style='text-align:center; '>
  <div class="callout-inner">
    
      <img src="https://github.com/IamLeandrooooo/MalwareCTFChallenges/blob/main/2025/NahamCon2025-CTF/Verification%20Clarification/images/10.png?raw=true" alt="Screenshot of the challenge page">
    
  </div>
</div>

<p>On closer inspection, I realized the string wasn‚Äôt valid Base64 as-is because the script performs a replacement operation, replacing every occurrence of <code>S6R</code> with <code>[CHAR]34</code>, which represents a double quote (<code>&quot;</code> character). This behavior can be seen in the following line:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#f92672">-REPLACE</span> <span style="color:#e6db74">&#39;S6R&#39;</span>, [<span style="color:#66d9ef">CHAR</span>]<span style="color:#ae81ff">34</span>
</span></span></code></pre></div><p>By removing the <code>S6R</code> placeholders from the Base64 string, it transforms into a valid Base64-encoded string. After cleaning it up, I was able to successfully decode it, which revealed the final payload and the flag.</p>

<div class='callout callout-customimg' style='text-align:center; '>
  <div class="callout-inner">
    
      <img src="https://github.com/IamLeandrooooo/MalwareCTFChallenges/blob/main/2025/NahamCon2025-CTF/Verification%20Clarification/images/11.png?raw=true" alt="Screenshot of the challenge page">
    
  </div>
</div>


        </section>
        <div class="post-tags">
          
          
          
        </div>
      </div>

      
      
    </div>

    </article>
</main>
<footer>
  <div style="display:flex"></div>
  <div class="footer-info">
    2025  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>

</div>
    </body>
</html>
